<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-shell">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div>
        <div class="logo">
          <div class="logo-badge"><span>R</span></div>
          <div>
            <div class="logo-text-main">Resume Builder</div>
            <div class="logo-text-sub">Fill it out, save, and generate.</div>
          </div>
        </div>

        <div class="sidebar-steps">
          <div class="step active" data-step="1">
            <div class="step-badge">1</div>
            <div>
              <div class="step-title">Start</div>
              <div>Welcome screen.</div>
            </div>
          </div>
          <div class="step" data-step="2">
            <div class="step-badge">2</div>
            <div>
              <div class="step-title">Enter info</div>
              <div>Resume details and sections.</div>
            </div>
          </div>
          <div class="step" data-step="3">
            <div class="step-badge">3</div>
            <div>
              <div class="step-title">Generate</div>
              <div>Send data to backend.</div>
            </div>
          </div>
          <div class="step" data-step="4">
            <div class="step-badge">4</div>
            <div>
              <div class="step-title">Preview</div>
              <div>View generated resume.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar-footer">
        Team: <span>You</span> (UI) · <span>Fields</span> · <span>Casen</span> (Python)
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">

      <!-- SCREEN 1 -->
      <section class="screen active" id="screen-start">
        <header class="screen-header">
          <h1 class="screen-title">Resume Builder</h1>
          <p class="screen-subtitle">Fill in your information.</p>
        </header>

        <div class="hero-card">
          <div class="hero-orb"></div>
          <div class="hero-badge"><span></span> Simple multi-step resume form</div>
          <div class="hero-title">Enter your details.</div>
          <p class="hero-text">Use this form to generate a resume.</p>

          <div class="hero-cta-row">
            <button class="btn btn-primary" id="start-btn">
              Start <span>&rarr;</span>
            </button>
            <button class="btn btn-secondary" id="jump-to-form-btn">Go to form</button>
          </div>
        </div>
      </section>

      <!-- SCREEN 2: FORM -->
      <section class="screen" id="screen-form">
        <header class="screen-header">
          <h2 class="screen-title">Enter your information</h2>
          <p class="screen-subtitle">Contact info, education, experience, projects, and skills.</p>
        </header>

        <form id="resume-form">
          <div class="form-layout">

            <!-- LEFT COLUMN -->
            <div>
              <!-- NAME & CONTACT -->
              <div class="form-section">
                <div class="form-section-header">
                  <div class="form-section-title">Name & Contact</div>
                  <div class="form-section-tag">Basic info</div>
                </div>

                <div class="field-group">
                  <div class="field"><label>Name</label><input id="full_name" name="full_name"></div>
                  <div class="field"><label>Phone number</label><input id="phone" name="phone"></div>
                  <div class="field"><label>Email</label><input id="email" name="email"></div>
                  <div class="field"><label>LinkedIn</label><input id="linkedin" name="linkedin"></div>
                  <div class="field"><label>GitHub</label><input id="github" name="github"></div>
                </div>
              </div>

              <!-- EDUCATION -->
              <div class="form-section" style="margin-top: 1rem;">
                <div class="form-section-header">
                  <div class="form-section-title">Education</div>
                  <div class="form-section-tag">University</div>
                </div>

                <div class="field-group">
                  <div class="field"><label>University name</label><input id="uni_name" name="uni_name"></div>
                  <div class="field"><label>Location</label>
                    <div class="field-row-two">
                      <input id="edu_city" name="edu_city" placeholder="City">
                      <input id="edu_state" name="edu_state" placeholder="State">
                    </div>
                  </div>
                  <div class="field"><label>Graduation</label>
                    <div class="field-row-two">
                      <input id="grad_month" name="grad_month" placeholder="Month">
                      <input id="grad_year" name="grad_year" placeholder="Year">
                    </div>
                  </div>
                  <div class="field"><label>Degree</label><input id="degree" name="degree"></div>
                  <div class="field"><label>GPA</label><input id="gpa" name="gpa"></div>
                  <div class="field"><label>Majors</label><input id="majors" name="majors"></div>
                </div>
              </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div>
              <!-- EXPERIENCE -->
              <div class="form-section">
                <div class="form-section-header">
                  <div class="form-section-title">Experience</div>
                  <div class="form-section-tag">Work</div>
                </div>

                <div class="field-group">
                  <div class="field"><label>Coordinator</label><input id="exp_coordinator" name="exp_coordinator"></div>
                  <div class="field"><label>Role</label><input id="exp_name" name="exp_name"></div>

                  <div class="field"><label>Location</label>
                    <div class="field-row-two">
                      <input id="exp_city" name="exp_city">
                      <input id="exp_state" name="exp_state">
                    </div>
                  </div>

                  <div class="field"><label>Timeline</label>
                    <div class="field-row-two">
                      <input id="exp_start_month" name="exp_start_month" placeholder="Start">
                      <input id="exp_start_year" name="exp_start_year" placeholder="Year">
                    </div>
                    <div class="field-row-two" style="margin-top: 0.35rem;">
                      <input id="exp_end_month" name="exp_end_month" placeholder="End">
                      <input id="exp_end_year" name="exp_end_year" placeholder="Year">
                    </div>
                  </div>

                  <div class="field">
                    <label>Experience details</label>
                    <textarea id="exp_details" name="exp_details" placeholder="- Bullet 1&#10;- Bullet 2"></textarea>
                  </div>
                </div>
              </div>

              <!-- PROJECT -->
              <div class="form-section" style="margin-top: 1rem;">
                <div class="form-section-header">
                  <div class="form-section-title">Projects</div>
                  <div class="form-section-tag">Portfolio</div>
                </div>

                <div class="field-group">
                  <div class="field"><label>Project name</label><input id="proj_name" name="proj_name"></div>
                  <div class="field"><label>Project details</label>
                    <textarea id="proj_details" name="proj_details"></textarea>
                  </div>
                </div>
              </div>

              <!-- SKILLS -->
              <div class="form-section" style="margin-top: 1rem;">
                <div class="form-section-header">
                  <div class="form-section-title">Skills</div>
                  <div class="form-section-tag">Technical</div>
                </div>

                <div class="field-group">
                  <div class="field">
                    <label>Skills</label>
                    <textarea id="skills" name="skills"></textarea>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="form-footer">
            <button class="btn btn-secondary" id="back-to-start-btn">← Back</button>
            <button type="submit" class="btn btn-primary">Generate resume</button>
          </div>

        </form>
      </section>

      <!-- SCREEN 3: GENERATING -->
      <section class="screen" id="screen-generating">
        <div class="centered">
          <div class="spinner"></div>
          <div>
            <div class="screen-title">Generating…</div>
            <p class="screen-subtitle">Working with your resume data.</p>
          </div>
        </div>
      </section>

      <!-- SCREEN 4: PREVIEW -->
      <section class="screen" id="screen-preview">
        <header class="screen-header">
          <h2 class="screen-title">Preview</h2>
          <p class="screen-subtitle">Your data and generated resume.</p>
        </header>

        <div class="preview-layout">
          <div class="preview-card">
            <h3>Captured Data</h3>
            <pre id="preview-json" class="preview-json"></pre>
          </div>

          <div class="preview-card">
            <h3>Generated Resume</h3>
            <iframe id="resume-iframe" style="width:100%; height:400px;"></iframe>

            <button id="download-btn" class="btn btn-primary" style="margin-top:12px;">
              Download resume.html
            </button>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    const screens = document.querySelectorAll(".screen");
    const steps = document.querySelectorAll(".step");

    function showScreen(id) {
      screens.forEach((s) => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");

      const stepMap = {
        "screen-start": 1,
        "screen-form": 2,
        "screen-generating": 3,
        "screen-preview": 4,
      };
      const activeStep = stepMap[id];
      steps.forEach((step) => {
        const n = Number(step.getAttribute("data-step"));
        step.classList.toggle("active", n === activeStep);
      });
    }

    document.getElementById("start-btn").onclick = () => showScreen("screen-form");
    document.getElementById("jump-to-form-btn").onclick = () => showScreen("screen-form");
    document.getElementById("back-to-start-btn").onclick = () => showScreen("screen-start");

    const form = document.getElementById("resume-form");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = Object.fromEntries(new FormData(form).entries());
      window.resumeData = data;

      // Switch to generating screen
      showScreen("screen-generating");

      try {
        const res = await fetch("http://127.0.0.1:8000/generate-resume", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data }),
        });

        const result = await res.json();

        // Show JSON preview
        document.getElementById("preview-json").textContent =
          JSON.stringify(window.resumeData, null, 2);

        // Load generated HTML into iframe
        const iframe = document.getElementById("resume-iframe");
        iframe.srcdoc = result.html;

        // Setup download
        document.getElementById("download-btn").onclick = () => {
          const blob = new Blob([result.html], { type: "text/html" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "resume.html";
          link.click();
        };

        showScreen("screen-preview");

      } catch (err) {
        alert("Error generating resume. Is the backend running?");
        console.error(err);
      }
    });

  </script>

</body>
</html>
